name : Build and package ROBERTA-SEQUENCING TO DOCKERHUB

on:
  #triggers the workflow on pull or push  request events for the main branch
  
  push:
    branches: [ main ]
  #allow to run this worflow mannually from the Actions tab
  workflow_dispatch:

  jobs:
  
    build:
      runs-on : ubuntu latest
      steps:

      - uses: actions/checkout@v4

      - name: Authenticate wit azure
        uses: azure/login@v1
        with:
          creds: ${{}}
      - name: set auto-install of extensions
        run: az config set extention.use_dynamic_install=yes_without_prompt
      - name: attach workspace
        run: az ml folder attach -w "ml-ws" -g "pratical_ml_book"
      - name: retrieve the model
        run: az ml model download -t "." --model-id "roberta--seqence:1"

      - name: build flask-app container
        uses: docker/build-push-action@v2
        with:
          context: ./
          file: ./Dockerfile
          push: false
          tags: evanstats/flask-roberta:latest
